# MCP Integration

Connect Prism Context Engine to your favorite AI coding assistant using the Model Context Protocol (MCP).

## What is MCP?

The [Model Context Protocol](https://modelcontextprotocol.io) is an open standard that allows AI assistants to access external tools and data sources. Prism Context Engine implements an MCP server that provides your architectural rules to any compatible IDE.

## Supported IDEs

| IDE | Status | Protocol |
|-----|--------|----------|
| **Cursor** | âœ… Supported | MCP via stdio |
| **Windsurf** | âœ… Supported | MCP via stdio |
| **Claude Desktop** | âœ… Supported | MCP via stdio |
| **VS Code + Continue** | ðŸ”„ Coming Soon | MCP via HTTP |

## Cursor Setup

### 1. Locate Your Cursor Config

Open your Cursor settings directory:
- **Windows**: `%APPDATA%\Cursor\User\`
- **macOS**: `~/Library/Application Support/Cursor/User/`
- **Linux**: `~/.config/Cursor/User/`

### 2. Edit `mcp.json`

Create or edit the `mcp.json` file:

```json
{
  "mcpServers": {
    "prism": {
      "command": "npx",
      "args": ["tsx", "/path/to/jeffdev-monorepo/apps/prism-mcp-server/src/index.ts"],
      "env": {
        "MONGODB_URI": "your-cosmos-db-connection-string",
        "AZURE_OPENAI_ENDPOINT": "https://your-resource.openai.azure.com/",
        "AZURE_OPENAI_API_KEY": "your-api-key",
        "AZURE_OPENAI_EMBEDDING_DEPLOYMENT_NAME": "text-embedding-3-small"
      }
    }
  }
}
```

import { Callout } from 'nextra/components'

<Callout type="warning">
  Replace `/path/to/jeffdev-monorepo` with your actual monorepo path. On Windows, use forward slashes or escaped backslashes.
</Callout>

<Callout type="info">
  The `search_video_transcript` tool requires Azure OpenAI credentials for generating query embeddings. If you only need rules validation, you can omit the Azure OpenAI env vars.
</Callout>

### 3. Restart Cursor

Restart Cursor to load the MCP server. You should see "prism" in your MCP connections.

## Available Tools

Once connected, the AI assistant has access to these tools:

### `get_architectural_rules`

Fetches all active architectural rules filtered by optional category.

```typescript
// AI can call this to understand your codebase constraints
get_architectural_rules({ category: "architecture" })
```

**Parameters:**
- `category` (optional): Filter by category (architecture, styling, security, performance, testing, documentation)
- `tags` (optional): Array of tags to filter by

**Returns**: Array of rules with ID, name, category, tags, content, and priority.

### `validate_code_pattern`

Validates code against active architectural rules and reports violations.

```typescript
// AI uses this before suggesting code
validate_code_pattern({ 
  code: "import { Button } from '../../apps/agency/Button'",
  filePath: "apps/prism-dashboard/src/page.tsx",
  language: "typescript"
})
```

**Parameters:**
- `code`: The code snippet to validate
- `filePath` (optional): File path for context
- `language` (optional): Programming language (typescript, javascript, python, etc.)

**Returns**: Validation result with violations array and suggestions.

### `search_video_transcript`

**ðŸ†• NEW:** Semantically search through video transcripts using AI embeddings.

```typescript
// AI can search your architecture videos for relevant context
search_video_transcript({ 
  query: "How should I handle API errors?",
  topK: 3
})
```

**Parameters:**
- `query`: Natural language search query
- `topK` (optional): Number of results to return (default: 3)

**Returns**: Most relevant transcript snippets with:
- Video title and asset ID
- Matching text with timestamps
- Similarity score
- Link to full transcript

**Example Use Case:**
> "I'm implementing a payment flow. Let me search the architecture videos..."
> AI calls `search_video_transcript({ query: "payment processing error handling" })`
> Returns snippet from your Stripe integration video at 3:42

See [Semantic Search Guide](/guide/semantic-search) for details on how vector search works.

## Available Resources

Prism also exposes resources that the AI can read:

| URI | Description |
|-----|-------------|
| `prism://rules/all` | All active rules as JSON |
| `prism://rules/architecture` | Architecture rules only |
| `prism://rules/styling` | Styling rules only |
| `prism://rules/security` | Security rules only |

## Troubleshooting

### Server Not Connecting

1. Check the path to `index.ts` is correct
2. Ensure `MONGODB_URI` is set in the env block
3. Check Cursor's MCP logs for errors

### Rules Not Loading

1. Verify your database has rules: `doppler run -- npm run db:seed -w packages/db`
2. Check the MongoDB connection string is valid
3. Ensure the `prism` database exists

### AI Ignoring Rules

The AI uses rules as *guidance*, not hard constraints. For strict enforcement:
1. Increase the rule's priority (lower number = higher priority)
2. Add "MUST" or "ALWAYS" language in the rule content
3. Include specific code examples
